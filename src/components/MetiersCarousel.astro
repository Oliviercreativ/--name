---
// src/components/MetiersCarousel.astro
// Composant carousel pour la section m√©tiers
---

<section id="metiers" class="py-20 bg-gray-50">
    <div class="max-w-6xl mx-auto px-4 sm:px-6">
        <div class="text-center mb-16">
            <h2 class="text-4xl lg:text-5xl font-bold text-gray-900 mb-6">
                Adapt√© √† votre m√©tier
            </h2>
            <p class="text-xl text-gray-600">
                Des solutions sur mesure pour chaque profession
            </p>
        </div>

        <!-- Carousel Container -->
        <div class="relative overflow-hidden">
            <div id="carousel-wrapper" class="flex transition-transform duration-500 ease-in-out">
                <!-- Slide 1 -->
                <div class="carousel-slide w-full flex-shrink-0">
                    <div class="grid md:grid-cols-3 gap-8">
                        <!-- Artisans -->
                        <div class="bg-white rounded-2xl p-8 shadow-sm">
                            <div class="w-12 h-12 bg-orange-100 rounded-xl flex items-center justify-center mb-6">
                                <span class="text-orange-600 text-2xl">üîß</span>
                            </div>
                            <h3 class="text-xl font-bold text-gray-900 mb-4">Artisans</h3>
                            <ul class="space-y-3 text-gray-600">
                                <li class="flex items-center space-x-2">
                                    <span class="text-green-500">‚úì</span>
                                    <span>Gestion des chantiers</span>
                                </li>
                                <li class="flex items-center space-x-2">
                                    <span class="text-green-500">‚úì</span>
                                    <span>Suivi des devis</span>
                                </li>
                                <li class="flex items-center space-x-2">
                                    <span class="text-green-500">‚úì</span>
                                    <span>Planning des interventions</span>
                                </li>
                            </ul>
                        </div>

                        <!-- Agents immobiliers -->
                        <div class="bg-white rounded-2xl p-8 shadow-sm">
                            <div class="w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center mb-6">
                                <span class="text-blue-600 text-2xl">üè†</span>
                            </div>
                            <h3 class="text-xl font-bold text-gray-900 mb-4">Agents immobiliers</h3>
                            <ul class="space-y-3 text-gray-600">
                                <li class="flex items-center space-x-2">
                                    <span class="text-green-500">‚úì</span>
                                    <span>Gestion des biens</span>
                                </li>
                                <li class="flex items-center space-x-2">
                                    <span class="text-green-500">‚úì</span>
                                    <span>Suivi des visites</span>
                                </li>
                                <li class="flex items-center space-x-2">
                                    <span class="text-green-500">‚úì</span>
                                    <span>Automatisation des relances</span>
                                </li>
                            </ul>
                        </div>

                        <!-- Consultants -->
                        <div class="bg-white rounded-2xl p-8 shadow-sm">
                            <div class="w-12 h-12 bg-purple-100 rounded-xl flex items-center justify-center mb-6">
                                <span class="text-purple-600 text-2xl">üíº</span>
                            </div>
                            <h3 class="text-xl font-bold text-gray-900 mb-4">Consultants</h3>
                            <ul class="space-y-3 text-gray-600">
                                <li class="flex items-center space-x-2">
                                    <span class="text-green-500">‚úì</span>
                                    <span>Gestion des projets</span>
                                </li>
                                <li class="flex items-center space-x-2">
                                    <span class="text-green-500">‚úì</span>
                                    <span>Facturation automatique</span>
                                </li>
                                <li class="flex items-center space-x-2">
                                    <span class="text-green-500">‚úì</span>
                                    <span>Suivi du temps</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Navigation Buttons -->
            <button id="prevBtn" class="absolute left-4 top-1/2 -translate-y-1/2 bg-white/80 hover:bg-white p-2 rounded-full shadow-lg">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                </svg>
            </button>
            <button id="nextBtn" class="absolute right-4 top-1/2 -translate-y-1/2 bg-white/80 hover:bg-white p-2 rounded-full shadow-lg">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                </svg>
            </button>

            <!-- Dots Navigation -->
            <div class="flex justify-center mt-8 space-x-2">
                <button class="carousel-dot w-2 h-2 rounded-full bg-gray-300 transition-all duration-300"></button>
                <button class="carousel-dot w-2 h-2 rounded-full bg-gray-300 transition-all duration-300"></button>
                <button class="carousel-dot w-2 h-2 rounded-full bg-gray-300 transition-all duration-300"></button>
                <button class="carousel-dot w-2 h-2 rounded-full bg-gray-300 transition-all duration-300"></button>
            </div>
        </div>
    </div>
</section>

<style>
    .gradient-text {
        background: linear-gradient(135deg, #f97316, #ea580c);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }
    
    .metier-card {
        cursor: pointer;
        border: 2px solid transparent;
    }
    
    .metier-card:hover {
        border-color: #f97316;
        box-shadow: 0 10px 25px rgba(249, 115, 22, 0.15);
    }
    
    .carousel-dot.active {
        transform: scale(1.5);
    }
    
    /* Animation des cards au changement de slide */
    .carousel-slide {
        opacity: 1;
        transition: opacity 0.5s ease-in-out;
    }
    
    @media (max-width: 768px) {
        .carousel-slide {
            padding: 0 1rem;
        }
        
        .metier-card {
            margin-bottom: 1rem;
        }
    }
</style>

<script type="module">
    // Attendre que le DOM soit charg√©
    document.addEventListener('DOMContentLoaded', () => {
        // Carousel functionality
        let currentSlide = 0;
        const totalSlides = 4;
        const carousel = document.getElementById('carousel-wrapper');
        const dots = document.querySelectorAll('.carousel-dot');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const carouselSection = document.getElementById('metiers');

        if (!carousel || !dots.length || !prevBtn || !nextBtn || !carouselSection) {
            console.warn('Certains √©l√©ments du carousel sont manquants');
            return;
        }

        function updateCarousel() {
            const translateX = -currentSlide * 100;
            carousel.style.transform = `translateX(${translateX}%)`;
            
            // Update dots
            dots.forEach((dot, index) => {
                if (index === currentSlide) {
                    dot.classList.add('active');
                    dot.classList.remove('bg-gray-300');
                    dot.classList.add('bg-zest-500');
                } else {
                    dot.classList.remove('active');
                    dot.classList.remove('bg-zest-500');
                    dot.classList.add('bg-gray-300');
                }
            });
        }

        function nextSlide() {
            currentSlide = (currentSlide + 1) % totalSlides;
            updateCarousel();
        }

        function prevSlide() {
            currentSlide = (currentSlide - 1 + totalSlides) % totalSlides;
            updateCarousel();
        }

        function goToSlide(slideIndex) {
            currentSlide = slideIndex;
            updateCarousel();
        }

        // Event listeners
        nextBtn.addEventListener('click', nextSlide);
        prevBtn.addEventListener('click', prevSlide);

        dots.forEach((dot, index) => {
            dot.addEventListener('click', () => goToSlide(index));
        });

        // Auto-advance every 8 seconds
        let autoAdvance = setInterval(nextSlide, 8000);

        // Touch/swipe support for mobile
        let startX = 0;
        let endX = 0;

        carousel.addEventListener('touchstart', (e) => {
            startX = e.touches[0].clientX;
        });

        carousel.addEventListener('touchend', (e) => {
            endX = e.changedTouches[0].clientX;
            handleSwipe();
        });

        function handleSwipe() {
            const swipeThreshold = 50;
            const diff = startX - endX;
            
            if (Math.abs(diff) > swipeThreshold) {
                if (diff > 0) {
                    nextSlide(); // Swipe left = next
                } else {
                    prevSlide(); // Swipe right = previous
                }
            }
        }

        // Pause auto-advance on hover
        carouselSection.addEventListener('mouseenter', () => {
            clearInterval(autoAdvance);
        });

        carouselSection.addEventListener('mouseleave', () => {
            autoAdvance = setInterval(nextSlide, 8000);
        });
    });

    // RDV booking function (to be connected to your calendar)
    function bookMeeting() {
        window.open('https://calendar.app.google/GAuyVQfSgfuaZ6wL7', '_blank');
    }
</script>